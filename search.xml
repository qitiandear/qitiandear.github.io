<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>vue3å¸¸è§çš„ä½¿ç”¨åœºæ™¯</title>
      <link href="/2023/01/06/vue3-chang-jian-de-shi-yong-chang-jing/"/>
      <url>/2023/01/06/vue3-chang-jian-de-shi-yong-chang-jing/</url>
      
        <content type="html"><![CDATA[<p>Vueæ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦å­¦ä¹ vue3çš„æ–°ç‰¹æ€§å’Œæ–°å¢çš„APIï¼Œä¸»è¦æ˜¯æœ‰ Vue 2 ç»éªŒçš„ç”¨æˆ·å¿«é€Ÿç†Ÿæ‚‰vue3.</p><h2 id="çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’"><a href="#çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’" class="headerlink" title="çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’"></a>çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’</h2><h3 id="çˆ¶ç»„ä»¶æ•°æ®ä¼ é€’åˆ°å­ç»„ä»¶"><a href="#çˆ¶ç»„ä»¶æ•°æ®ä¼ é€’åˆ°å­ç»„ä»¶" class="headerlink" title="çˆ¶ç»„ä»¶æ•°æ®ä¼ é€’åˆ°å­ç»„ä»¶"></a>çˆ¶ç»„ä»¶æ•°æ®ä¼ é€’åˆ°å­ç»„ä»¶</h3><p>Vue3 ä¸­çˆ¶ç»„ä»¶æ˜¯é€šè¿‡å±æ€§ä¼ é€’æ•°æ®ï¼Œåœ¨ <code>&lt;script setup&gt;</code> ä¸­ï¼Œ<code>props</code> éœ€è¦ä½¿ç”¨ <code>defineProps()</code> è¿™ä¸ªå®å‡½æ•°æ¥è¿›è¡Œå£°æ˜ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> çˆ¶ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'./HelloWorld.vue'</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>HelloWorld address<span class="token operator">=</span><span class="token string">"parent address"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> å­ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token comment">// parent address</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ä½¿ç”¨ address æˆ– props<span class="token punctuation">.</span>address <span class="token operator">--</span><span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼š<code>defineProps</code> ã€<code>defineEmits</code> ã€ <code>defineExpose</code> å’Œ <code>withDefaults</code> è¿™å››ä¸ªå®å‡½æ•°åªèƒ½åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨ã€‚ä»–ä»¬ä¸éœ€è¦å¯¼å…¥ï¼Œä¼šéšç€ <code>&lt;script setup&gt;</code> çš„å¤„ç†è¿‡ç¨‹ä¸­ä¸€èµ·è¢«ç¼–è¯‘ã€‚eslintæ£€æµ‹æŠ¥è­¦å‘Šåœ¨package.jsonä¸­æ·»åŠ </p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token string">"eslintConfig"</span> <span class="token punctuation">{</span>    <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"vue/setup-compiler-macros"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å­ç»„ä»¶æ•°æ®ä¼ é€’åˆ°çˆ¶ç»„ä»¶"><a href="#å­ç»„ä»¶æ•°æ®ä¼ é€’åˆ°çˆ¶ç»„ä»¶" class="headerlink" title="å­ç»„ä»¶æ•°æ®ä¼ é€’åˆ°çˆ¶ç»„ä»¶"></a>å­ç»„ä»¶æ•°æ®ä¼ é€’åˆ°çˆ¶ç»„ä»¶</h3><p>åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨ <code>defineEmits()</code>:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> å­ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'getMsg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'getMsg'</span><span class="token punctuation">,</span> <span class="token string">'child message'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"onClick"</span><span class="token operator">&gt;</span>ç‚¹å‡»<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> çˆ¶ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'./HelloWorld.vue'</span><span class="token keyword">function</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// child message</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>HelloWorld @get<span class="token operator">-</span>msg<span class="token operator">=</span><span class="token string">"getMsg"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ•°æ®"><a href="#çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ•°æ®" class="headerlink" title="çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ•°æ®"></a>çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ•°æ®</h3><p>åœ¨ <code>&lt;script setup&gt;</code> ä¸­ï¼Œç»„ä»¶çš„å±æ€§å’Œæ–¹æ³•é»˜è®¤éƒ½æ˜¯ç§æœ‰çš„ã€‚çˆ¶ç»„ä»¶æ— æ³•è®¿é—®åˆ°å­ç»„ä»¶ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Œé™¤éå­ç»„ä»¶é€šè¿‡ <code>defineExpose</code> æ˜¾å¼çš„æš´éœ²å‡ºå»ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> å­ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'hello vue3!'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'hi vue3!'</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// å±æ€§æˆ–æ–¹æ³•å¿…é¡»æš´éœ²å‡ºå»ï¼Œçˆ¶ç»„ä»¶æ‰èƒ½ä½¿ç”¨</span><span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg<span class="token punctuation">,</span> change <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> çˆ¶ç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'./HelloWorld.vue'</span><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>value<span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token comment">// hello vue3!</span>  child<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// hi vue3!</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>HelloWorld ref<span class="token operator">=</span><span class="token string">"child"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–ä¸Šä¸‹æ–‡å¯¹è±¡"><a href="#è·å–ä¸Šä¸‹æ–‡å¯¹è±¡" class="headerlink" title="è·å–ä¸Šä¸‹æ–‡å¯¹è±¡"></a>è·å–ä¸Šä¸‹æ–‡å¯¹è±¡</h2><p>Vue3 çš„ <code>setup</code> ä¸­é€šè¿‡ <code>getCurrentInstance</code> æ–¹æ³•è·å–ä¸Šä¸‹æ–‡å¯¹è±¡:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// ä»¥ä¸‹ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥è·å–åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡</span><span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span> proxy <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>$parent</code> ã€<code>$refs</code> ç­‰ï¼Œå¹²è‡ªå·±æƒ³å¹²çš„äº‹æƒ…äº†ï¼Œä¸‹é¢æ˜¯æˆ‘æ‰“å°å‡ºæ¥çš„ <code>ctx</code> çš„å®Œæ•´å±æ€§ã€‚</p><p><img src="https://kun.nwyp123.com/20230106144156.png"></p><p>æ³¨æ„ï¼š<code>ctx</code> åªèƒ½åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œç”Ÿæˆç¯å¢ƒä¸º <code>undefined</code> ã€‚ æ¨èä½¿ç”¨ <code>proxy</code> ï¼Œåœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒéƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä½¿ç”¨åœºæ™¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ruståŸºç¡€</title>
      <link href="/2022/12/30/rust-ji-chu/"/>
      <url>/2022/12/30/rust-ji-chu/</url>
      
        <content type="html"><![CDATA[<p>å˜é‡ï¼ŒåŸºæœ¬ç±»å‹ï¼Œå‡½æ•°ï¼Œæ³¨é‡Šå’Œæ§åˆ¶æµï¼Œè¿™äº›å‡ ä¹æ˜¯æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½å…·æœ‰çš„ç¼–ç¨‹æ¦‚å¿µã€‚</p><p>è¿™äº›åŸºç¡€æ¦‚å¿µå°†å­˜åœ¨äºæ¯ä¸ª Rust ç¨‹åºä¸­ï¼ŒåŠæ—©å­¦ä¹ å®ƒä»¬å°†ä½¿ä½ ä»¥æœ€å¿«çš„é€Ÿåº¦å­¦ä¹  Rust çš„ä½¿ç”¨ã€‚</p><h2 id="å˜é‡å’Œå¯å˜æ€§"><a href="#å˜é‡å’Œå¯å˜æ€§" class="headerlink" title="å˜é‡å’Œå¯å˜æ€§"></a>å˜é‡å’Œå¯å˜æ€§</h2><h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h3><ul><li>å˜é‡ï¼ˆvariablesï¼‰:ç”¨æ¥å­˜å‚¨å€¼çš„ä¸€ä¸ªåœ°æ–¹ï¼ˆStoring values with Variablesï¼‰,é»˜è®¤æ˜¯immutable</li><li>å¸¸é‡ï¼ˆconstantsï¼‰:ä»…å¯è¢«èµ‹å€¼ä¸€æ¬¡çš„å˜é‡</li><li>å¯å˜æ€§ï¼ˆmutabilityï¼‰ï¼šé€šè¿‡mutæ¥å®šä¹‰ï¼Œä»£è¡¨å€¼å¯å˜çš„å˜é‡ï¼ˆç±»ä¼¼letï¼Œå¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼‰</li></ul><p>ã€é”™è¯¯å†™æ³•ã€‘</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// let mut a = 6;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the variable is {}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¿™é‡Œrustä¼šæŠ¥é”™</span>    a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the variable is {}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ã€æ­£ç¡®å†™æ³•ã€‘å½“ä½¿ç”¨<code>mut</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…è®¸å˜é‡çš„å€¼è¢«æ›´æ”¹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// é€šè¿‡mutæ¥åŒºåˆ†ç±»ä¼¼constå’Œletçš„æ¦‚å¿µ</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the variable is {}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the variable is {}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Itâ€™s important that we get compile-time errors when we attempt to change a value that we previously designated as immutable because this very situation can lead to bugs. If one part of our code operates on the assumption that a value will never change and another part of our code changes that value, itâ€™s possible that the first part of the code wonâ€™t do what it was designed to do. The cause of this kind of bug can be difficult to track down after the fact, especially when the second piece of code changes the value only sometimes<br>å¤§ä½“çš„æ„æ€å°±æ˜¯ï¼Œä¸ºäº†é¿å…bugå’Œä»£ç ä¸­éé¢„æœŸçš„æˆåˆ†å¦‚æœæˆ‘ä»¬ä¸€ä¸ªå˜é‡å®šä¹‰çš„æ—¶å€™å‡è®¾ä»–æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå…¶å®å¦‚æœå¯¹å…¶äºŒæ¬¡èµ‹å€¼ï¼Œå…¶å®æ˜¯éç¬¦åˆé¢„æœŸçš„ï¼Œæ‰€ä»¥ç¼–è¯‘é˜¶æ®µä¼šæŠ¥é”™</p></blockquote><h3 id="2-å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«"><a href="#2-å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«" class="headerlink" title="2. å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«"></a>2. å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«</h3><p><code>Immutableå˜é‡</code>å’Œ<code>å¸¸é‡</code>ä¹‹é—´çš„åŒºåˆ«ï¼š</p><ul><li>ã€åŒºåˆ«ã€‘<code>mut</code>å…³é”®è¯ä¸èƒ½ç”¨æ¥ä¿®é¥°<code>const</code>çš„å˜é‡ï¼Œ<code>const</code>ä¸€ç›´æ˜¯ä¸å¯å˜çš„</li><li>ã€åŒºåˆ«ã€‘<code>const</code>å…³é”®å­—å¿…é¡»è¦æ³¨é‡Šç±»å‹ï¼Œå°±æ˜¯éœ€è¦ç»™å‡ºç±»å‹çš„è¯´æ˜</li><li>ã€åŒºåˆ«ã€‘<code>const</code>å…³é”®è¯å¯ä»¥åœ¨ä»»æ„çš„ä½œç”¨åŸŸè¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ</li><li>ã€åŒºåˆ«ã€‘<code>const</code>çš„èµ‹å€¼ï¼Œåªèƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°çš„è¡¨è¾¾å¼ï¼Œä¸èƒ½æ˜¯åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½è¢«è®¡ç®—å‡ºçš„è¿è¡Œåçš„ç»“æœï¼ˆå°±æ˜¯ä¸èƒ½æ˜¯ä¸€ä¸ªæ ¹æ®è¿è¡Œæ—¶ç¯å¢ƒå‚æ•°ä¸ä¸€æ ·ï¼ŒåŠ¨æ€è®¡ç®—å¾—åˆ°çš„åŠ¨æ€çš„ç»“æœï¼‰</li><li>ã€éåŒºåˆ«ã€‘å»ºè®®å®šä¹‰å¸¸é‡æ—¶ï¼Œé€šè¿‡<code>å¤§å†™å­—æ¯</code>å’Œ<code>_</code>çš„æ–¹å¼æ¥å®šä¹‰ï¼Œå˜é‡å®šä¹‰æ—¶å»ºè®®ä½¿ç”¨å°å†™ï¼Œå¹¶ä¸”åœ¨å•è¯é—´é€šè¿‡ä¸‹åˆ’çº¿çš„æ–¹å¼è¿›è¡Œéš”ç¦»çš„æ–¹å¼ï¼Œ<code>è§„èŒƒæœ‰æ•ˆçš„å‘½åæ–¹å¼è®©æˆ‘ä»¬åœ¨å†™ä»£ç æ—¶å¯¹å˜é‡çš„è¯†åˆ«ä¼šæ›´åŠ å‡†ç¡®ï¼Œåˆ©äºä»£ç çš„ç»´æŠ¤</code>ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// å…¨å±€çš„å£°æ˜æ˜¯è¢«å…è®¸çš„</span><span class="token comment">// åŒºåˆ«äºŒï¼šéœ€è¦é€šè¿‡ `: `æ¥å‘Šè¯‰rustè¿™ä¸ªå¸¸é‡å¯¹åº”çš„ç±»å‹</span><span class="token comment">// åŒºåˆ«ä¸‰ï¼šå¯ä»¥åœ¨å…¨å±€å®šä¹‰</span><span class="token keyword">const</span> <span class="token constant">C_C</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"_global cc"</span><span class="token punctuation">;</span><span class="token comment">// åŒºåˆ«å››ï¼šåªèƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼</span><span class="token keyword">const</span> <span class="token constant">THREE_HOURS_IN_SECONDS</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">// åŒºåˆ«ä¸‰ï¼šè¿™ä¸ªé‡Œä½¿ç”¨letä¼šæŠ¥é”™ï¼Œä¸èƒ½å†å…¨å±€å®šä¹‰</span><span class="token comment">// expected item, found keyword `let`</span><span class="token keyword">let</span> dd <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token constant">B_BIT</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the constant is {}, {}"</span><span class="token punctuation">,</span> <span class="token constant">C_C</span><span class="token punctuation">,</span> <span class="token constant">B_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-å˜é‡è¦†ç›–ï¼ˆé˜´å½±ï¼‰"><a href="#3-å˜é‡è¦†ç›–ï¼ˆé˜´å½±ï¼‰" class="headerlink" title="3. å˜é‡è¦†ç›–ï¼ˆé˜´å½±ï¼‰"></a>3. å˜é‡è¦†ç›–ï¼ˆé˜´å½±ï¼‰</h3><blockquote><p>TIPSï¼š è¿™é‡Œæˆ‘å…¶å®æ›´å€¾å‘äºå°†åŸæ–‡ä¸­çš„shadowingç¿»è¯‘æˆå˜é‡çš„è¦†å†™å’Œä½œç”¨åŸŸï¼Œå› ä¸ºçœ‹ä¸Šå»å’Œjsçš„ä½œç”¨åŸŸçœŸçš„å¾ˆåƒï¼Œå½“ç„¶å¯èƒ½ä¼šä¸ç¬¦åˆrustä¸­çš„å«æ³•</p></blockquote><p><code>ä½œç”¨åŸŸçš„å®šä¹‰å’Œç‰¹æ€§</code>ï¼šé€šè¿‡<code>{}</code>å›´èµ·æ¥çš„ä»£ç å—æ˜¯å•ç‹¬çš„ä½œç”¨åŸŸï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸå®šä¹‰çš„å˜é‡ï¼Œä¼šè¦†ç›–æ‰ä¸Šå±‚ä½œç”¨åŸŸä¸­æœ‰çš„å‚æ•°ï¼Œå’ŒJSè¡¨ç°ç›¸è¿‘</p><p><code>å˜é‡çš„è¦†å†™</code>ï¼šé€šè¿‡<code>let</code>å®šä¹‰åŒåçš„å˜é‡æ¥è¦†å†™ä¸Šé¢å·²ç»é€šè¿‡<code>let</code>å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœæ˜¯å˜é‡çš„è¦†å†™æ˜¯ä¸è¦æ±‚å‰ååŒåå˜é‡ç±»å‹ç›¸åŒçš„ï¼Œä½†æ˜¯<code>mut</code>å˜é‡çš„ä¿®æ”¹ï¼Œéœ€è¦å‰åæœ‰ä¸€å®šçš„ç±»å‹</p><p><code>æ³¨æ„ç‚¹</code>ï¼š<code>let</code>å®šä¹‰çš„å˜é‡é€šè¿‡<code>let</code>åœ¨è¦†å†™å’Œæ˜¯ä¸æ˜¯<code>mut</code>çš„å˜é‡å…¶å®æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºè¿™é‡Œæ˜¯æ–°åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯å¯¹å·²ç»ä¸å¯å˜çš„å˜é‡è¿›è¡Œèµ‹å€¼ï¼ˆç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ï¼‰ï¼Œæ‰€ä»¥æ˜¯ä¸¤ä¸ªç»´åº¦çš„äº‹æƒ…</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>åœ¨rustä¸­çš„æ•°æ®ç±»å‹ä¸»è¦åŒ…æ‹¬ä¸¤ç§ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œç»„åˆç±»å‹ï¼ˆcompoundï¼‰ï¼Œå› ä¸ºrustæœ¬æ¥æ˜¯ä¸€ä¸ª<code>é™æ€ç±»å‹è¯­è¨€</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç¼–è¯‘æ—¶å‘Šè¯‰rustæ‰€æœ‰å˜é‡çš„ç±»å‹ï¼Œæ‰€ä»¥åœ¨ç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œéœ€è¦è½¬æˆçš„ç±»å‹å£°æ˜ã€‚</p><h3 id="1-æ ‡é‡ç±»å‹"><a href="#1-æ ‡é‡ç±»å‹" class="headerlink" title="1. æ ‡é‡ç±»å‹"></a>1. æ ‡é‡ç±»å‹</h3><p>æ ‡é‡ç±»å‹å•è¡¨çš„æ˜¯å•ä¸€çš„å€¼ï¼Œä¸æ˜¯ç»„åˆçš„å€¼ï¼Œå…·ä½“çš„ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li>æ•´å‹ï¼ˆintegersï¼‰</li><li>æµ®ç‚¹å‹ï¼ˆfloatï¼‰</li><li>å¸ƒå°”ç±»å‹</li><li>å­—ç¬¦ä¸²ç±»å‹</li></ul><h4 id="æ•´å‹ç±»å‹"><a href="#æ•´å‹ç±»å‹" class="headerlink" title="æ•´å‹ç±»å‹"></a>æ•´å‹ç±»å‹</h4><table><thead><tr><th align="left">é•¿åº¦</th><th align="left">æœ‰ç¬¦å·</th><th align="left">æ— ç¬¦å·</th></tr></thead><tbody><tr><td align="left">8-bit</td><td align="left">i8</td><td align="left">u8</td></tr><tr><td align="left">16-bit</td><td align="left">i16</td><td align="left">u16</td></tr><tr><td align="left">32-bit</td><td align="left">i32</td><td align="left">u32</td></tr><tr><td align="left">64-bit</td><td align="left">i64</td><td align="left">u64</td></tr><tr><td align="left">128-bit</td><td align="left">i128</td><td align="left">u128</td></tr><tr><td align="left">arch</td><td align="left">isize</td><td align="left">usize</td></tr></tbody></table><p><code>æ³¨æ„ç‚¹</code></p><ul><li><p>æœ‰ç¬¦å·é€šè¿‡<code>i</code>å¼€å¤´ï¼Œæ— ç¬¦å·é€šè¿‡<code>u</code>å¼€å¤´</p></li><li><p>æ•´å‹çš„åŒºé—´ä¸ºï¼Œæœ‰ç¬¦å·ä¸º -2^n-1^ ~ 2^n-1^ - 1 ï¼Œæ— ç¬¦å·ä¸º0~2^n^ - 1</p></li><li><p><code>arch</code>ä»£è¡¨çš„æ˜¯å½“å‰æ“ä½œç³»ç»Ÿæ¶æ„æœ€å¤§çš„ä½æ•°ï¼Œæ¯”å¦‚x64å°±æ˜¯<code>u64</code>, <code>i64</code></p></li><li><p>è¡¨ç¤ºä¸åŒè¿›åˆ¶çš„æ–¹æ³•</p><ul><li>åè¿›åˆ¶ï¼š1_000,1000éƒ½æ˜¯åè¿›åˆ¶</li><li>åå…­è¿›åˆ¶ï¼š0xff</li><li>å…«è¿›åˆ¶ï¼š0o77</li><li>äºŒè¿›åˆ¶ï¼š0b1111_0000</li><li>å­—èŠ‚ï¼šbâ€™Aâ€™</li></ul></li><li><p>å¯¹äºæº¢å‡ºçš„å¤„ç†ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼ˆdebugæ¨¡å¼ï¼‰ä¼šæŠ¥é”™ï¼Œå¼•èµ·ä½ çš„æ³¨æ„ï¼Œä½†æ˜¯å¦‚æœæ˜¯<code>--release</code>æ¨¡å¼ä¸‹å¹¶ä¸ä¼šæŠ¥é”™ï¼Œä»–ä¼šæŠŠè¿™ä¸ªå€¼ç½®ä¸ºä½ è¶…è¿‡éƒ¨åˆ†çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºä»–ä¼šè‡ªåŠ¨åœ¨å¤–éƒ¨å¡«å……ä¸¤ä½ï¼Œæ¥æ¥æ”¶å¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥è™½ç„¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦æˆ‘ä»¬å¯¹åŠ å‡å’Œæœ€å¤§æœ€å°å€¼æ¥åšä¸€ä¸‹æ ¡éªŒï¼Œä¸»æµçš„åº“ä¸­éƒ½ä¼šæœ‰ç›¸åº”çš„æ–¹æ³•ï¼š</p><ul><li><code>wrapping_*</code>æ¥åšæ•°çš„è¿ç®—</li><li><code>checked_*</code>æ¥åˆ¤æ–­æ˜¯å¦æœ‰æº¢å‡ºï¼Œ<code>None</code>è¿”å›å€¼ä»£è¡¨æº¢å‡ºäº†</li><li><code>overflowing_*</code>è¿”å›å€¼å’Œä¸€ä¸ªå¸ƒå°”å€¼æ¥åˆ¤æ–­æ˜¯å¦æº¢å‡ºäº†</li><li><code>saturating_*</code>æ–¹æ³•æ¥ä»£è¡¨æ”¹å€¼åœ¨å®šä¹‰çš„åŒºé—´å†…</li></ul></li></ul><h4 id="æµ®ç‚¹ç±»å‹"><a href="#æµ®ç‚¹ç±»å‹" class="headerlink" title="æµ®ç‚¹ç±»å‹"></a>æµ®ç‚¹ç±»å‹</h4><p>æµ®ç‚¹ç±»å‹çš„å®šä¹‰åªæœ‰ä¸¤ä¸ªæ–¹æ³•<code>f32</code>å’Œ<code>f64</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ•°å€¼ç±»å‹</span>    <span class="token comment">// æµ®ç‚¹é™¤æ³•</span>    <span class="token comment">// å¦‚æœä¸æ˜¯2.0 / 3.0è¿”å›çš„æ˜¯0ï¼Œé»˜è®¤ä¸ºæ•´å‹</span>    <span class="token comment">// let float_num = 2 / 3;  </span>        <span class="token keyword">let</span> floorded<span class="token punctuation">:</span><span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span>    <span class="token comment">// è¿™æ ·æ˜¯0.66666</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the float is {}"</span><span class="token punctuation">,</span> floorded<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li>é»˜è®¤æ˜¯<code>f64</code>ä¸ºäº†ä¿è¯æµ®ç‚¹æ›´é«˜çš„ç²¾åº¦</li><li>å¦‚æœæ˜¯<code>2 / 3</code>çš„å½¢å¼è¿”å›çš„æ˜¯æ•´å‹ï¼Œä¹Ÿå°±æ˜¯0ï¼Œå¦‚æœéœ€è¦å¾—åˆ°å°æ•°ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯<code>2.0 / 3.0</code>ä¿è¯å³è¾¹éƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œæœ€åè®¡ç®—ç»“æœæ‰ä¼šæ˜¯æµ®ç‚¹æ•°</li></ul><h4 id="å¸ƒå°”ç±»å‹"><a href="#å¸ƒå°”ç±»å‹" class="headerlink" title="å¸ƒå°”ç±»å‹"></a>å¸ƒå°”ç±»å‹</h4><p>ç±»å‹é€šè¿‡<code>bool</code>æ¥è¿›è¡Œå®šä¹‰å³å¯ï¼Œç”¨äºæ¡ä»¶æ§åˆ¶ï¼Œè¿™ä¸ªåœ¨<code>if</code>çš„æ§åˆ¶æµä¸­ä¼šç”¨åˆ°ï¼Œå’Œæ‰€æœ‰è¯­è¨€çš„éƒ½ç±»ä¼¼</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> f<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="å­—ç¬¦ä¸²ç±»å‹"><a href="#å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h4><p>rustä¸­çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯æœ€åŸå§‹çš„å­—æ¯ç±»å‹,åŒ…å«ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡è¡¨æƒ…ç­‰å­—ç¬¦ï¼ˆUnicode Scalaræ¯”ASCIIç æ›´ä¸°å¯Œï¼‰</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char">'z'</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token char">'â„¤'</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> heart_eyed_cat <span class="token operator">=</span> 'ğŸ˜»'<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-ç»„åˆç±»å‹"><a href="#2-ç»„åˆç±»å‹" class="headerlink" title="2. ç»„åˆç±»å‹"></a>2. ç»„åˆç±»å‹</h3><h4 id="å…ƒç»„ç±»å‹"><a href="#å…ƒç»„ç±»å‹" class="headerlink" title="å…ƒç»„ç±»å‹"></a>å…ƒç»„ç±»å‹</h4><p>å…ƒç»„ç±»å‹æ˜¯å°†å¤šä¸ªå…¶ä»–ç±»å‹æ”¾åˆ°ä¸€ä¸ªç»„åˆç±»å‹ä¸­ï¼Œå…ƒç»„çš„ç‰¹ç‚¹ï¼š</p><ul><li>å›ºå®šçš„é•¿åº¦</li><li>ä¸€æ¬¡æ€§çš„å®šä¹‰</li><li>é•¿åº¦ä¸å¯æ”¶ç¼©</li><li>é€—å·åˆ†éš”çš„åˆ—è¡¨</li><li>é€šè¿‡<code>()</code>æ¥å®šä¹‰</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ç»„åˆç±»å‹</span>    <span class="token comment">// å…ƒç»„</span>    <span class="token keyword">let</span> tup<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i8</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">)</span> <span class="token operator">=</span> tup<span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tup -&gt; {}, {}, {}"</span><span class="token punctuation">,</span> tup<span class="token number">.0</span><span class="token punctuation">,</span> tup<span class="token number">.1</span><span class="token punctuation">,</span> tup<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tup -&gt; {}, {}, {}"</span><span class="token punctuation">,</span> t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li>å¯ä»¥é€šè¿‡.è¯­æ³•æ¥è¿›è¡Œå¯¹åº”ä½ç½®å…ƒç»„æ•°æ®çš„è·å–</li><li>å¯ä»¥é€šè¿‡è§£æ„çš„æ–¹å¼æ¥å›å»å¯¹åº”ä½ç½®ä¸Šçš„å€¼</li><li>æ¯ä¸ªä½ç½®å…ƒç´ çš„ç±»å‹å¯ä»¥<code>ä¸ç›¸åŒ</code></li></ul><h4 id="æ•°ç»„ç±»å‹"><a href="#æ•°ç»„ç±»å‹" class="headerlink" title="æ•°ç»„ç±»å‹"></a>æ•°ç»„ç±»å‹</h4><p>æ•°ç»„æ˜¯åŒä¸€ç§ç±»å‹çš„å…ƒç´ çš„é›†åˆï¼Œå’Œå…ƒç´ çš„ä¸åŒæ˜¯<code>å¿…é¡»æ‰€æœ‰å…ƒç´ å…·æœ‰ç›¸åŒçš„ç±»å‹</code>ï¼Œå…¶ç‰¹ç‚¹ï¼š</p><ul><li>å…ƒç´ ç±»å‹ç›¸åŒ</li><li>é€šè¿‡<code>[]</code>æ¥å®šä¹‰</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ•°ç»„</span>    <span class="token keyword">let</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> array2<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// å‰ä¸¤ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œè¿™ç§çš„æ„æ€æ˜¯ç”Ÿæˆä¸€ä¸ªæ•´å‹çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º5ï¼Œé»˜è®¤å€¼ä¸º3</span>    <span class="token keyword">let</span> array3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"str -&gt; {}"</span><span class="token punctuation">,</span> array2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li>æ¥å…¥æ•°ç»„çš„æ–¹å¼é€šè¿‡ç´¢å¼•æ¥æ¥å…¥ï¼Œä¾‹å¦‚<code>array2[1]</code></li><li>å¦‚æœè¿™ä¸ªindexæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€å®šè¦åˆ¤æ–­indexæ˜¯å¦å°äºæ•°ç»„çš„é•¿åº¦ï¼Œä¸ç„¶çš„è¯ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ çš„indexæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä½†æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½indexè¶…è¿‡äº†æœ€é•¿çš„æ•°ç»„é•¿åº¦æŠ¥é”™ï¼ˆ<code>è¶Šç•ŒæŠ¥é”™</code>ï¼‰</li></ul><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="1-å‡½æ•°å®šä¹‰æ–¹å¼"><a href="#1-å‡½æ•°å®šä¹‰æ–¹å¼" class="headerlink" title="1. å‡½æ•°å®šä¹‰æ–¹å¼"></a>1. å‡½æ•°å®šä¹‰æ–¹å¼</h3><p>å‡½æ•°çš„å®šä¹‰æ–¹å¼ï¼š</p><ul><li>é€šè¿‡<code>fn</code>å…³é”®å­—è¿›è¡Œå®šä¹‰</li><li>åœ¨<code>fn</code>åè·Ÿä¸Šç›¸åº”çš„å‡½æ•°å</li><li>é€šè¿‡<code>{}</code>æ¥ å®šä¹‰å‡½æ•°ä½“</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"this is main function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"this is another function, {}"</span><span class="token punctuation">,</span> <span class="token function">get_params</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">get_params</span>  <span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li>å‡½æ•°çš„è¾“å…¥å¯å®šä¹‰ç±»å‹ï¼Œè¾“å…¥é€šè¿‡<code>:</code>æ¥å®šä¹‰ç±»å‹</li><li>é»˜è®¤çš„å‡½æ•°æ˜¯ä¸å¸¦è¿”å›å€¼çš„ï¼Œå¦‚æœå¸¦ä¸Šè¿”å›å€¼éœ€è¦é€šè¿‡<code>-&gt;</code>æŒ‡å®šç±»å‹ï¼Œä¸ç„¶ä¼šæŠ¥é”™</li></ul><h3 id="2-å‡½æ•°ä½“åŒ…æ‹¬å£°æ˜å’Œè¡¨è¾¾å¼"><a href="#2-å‡½æ•°ä½“åŒ…æ‹¬å£°æ˜å’Œè¡¨è¾¾å¼" class="headerlink" title="2. å‡½æ•°ä½“åŒ…æ‹¬å£°æ˜å’Œè¡¨è¾¾å¼"></a>2. å‡½æ•°ä½“åŒ…æ‹¬å£°æ˜å’Œè¡¨è¾¾å¼</h3><p>Rust å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—å¯ä»¥ä»¥è¡¨è¾¾å¼ï¼ˆExpressionï¼‰ç»“å°¾çš„è¯­å¥ï¼ˆStatementï¼‰ç»„æˆã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…è§åˆ°äº†æ²¡æœ‰ä»¥è¡¨è¾¾å¼ç»“å°¾çš„å‡½æ•°ï¼Œä½†å·²ç»å°†è¡¨è¾¾å¼ç”¨ä½œè¯­å¥çš„ä¸€éƒ¨åˆ†ã€‚</p><p><code>æ³¨æ„ç‚¹</code></p><ul><li><p>å£°æ˜å¹¶ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€ä»¥ä¸æ”¯æŒJSä¸­çš„é‚£ç§è¿ç­‰å¼èµ‹å€¼ï¼Œç›®å‰æ˜¯ä¸è¢«å…è®¸çš„~</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œä¼šæŠ¥é”™`let` expressions in this position are experimental</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨rustä¸­è¡¨è¾¾å¼æ˜¯ä¸éœ€è¦åŒ…å«å°¾åˆ†å·çš„ï¼Œä¸€æ—¦ä½ ä½¿ç”¨äº†å°¾åˆ†å·å°±æŠŠè¡¨è¾¾å¼å˜æˆäº†å£°æ˜</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"this is main function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token comment">// è¿™é‡Œæ²¡æœ‰å°¾åˆ†å·</span>        <span class="token comment">// æ‰€ä»¥æ˜¯ä¸ªè¡¨è¾¾å¼ï¼ŒY -&gt; 4</span>        <span class="token comment">// å¦‚æœåŠ ä¸Šå°¾åˆ†å·ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºä»–å…¶å®è¿˜æ˜¯æ²¡æœ‰è¿”å›å€¼</span>        x<span class="token operator">+</span><span class="token number">1</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"y =&gt; {}"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥å°†å‡½æ•°çš„è¿”å›å€¼å’Œè¡¨è¾¾å¼ç»“åˆï¼Œè¿™æ ·å‡½æ•°ä¼šå˜å¾—æ›´åŠ ç®€æ´</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"this is main function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token function">addOne</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// y =&gt; 4</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"y =&gt; {}"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">addOne</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>    num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>æ³¨é‡Šä¸»è¦é€šè¿‡<code>//</code>æ¥è¿›è¡Œæ³¨é‡Šï¼Œå¦‚æœæ˜¯å¤šè¡Œçš„è¯ï¼Œå°±æ˜¯æ¯ä¸€è¡Œä¹‹æ°”éƒ½éœ€è¦é€šè¿‡<code>//</code>æ¥è¿›è¡Œæ³¨é‡Š</p><h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><p>åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½é€ƒä¸å¼€ç›¸å…³çš„æ§åˆ¶æµçš„è¯­æ³•ï¼Œä¾‹å¦‚<code>if</code>,å¾ªç¯<code>loop</code>ç­‰ï¼Œè¿™ä¸€å°èŠ‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹rustä¸­çš„å¾ªç¯å’Œåˆ¤æ–­è¯­æ³•</p><h3 id="1-ifè¡¨è¾¾å¼"><a href="#1-ifè¡¨è¾¾å¼" class="headerlink" title="1. ifè¡¨è¾¾å¼"></a>1. ifè¡¨è¾¾å¼</h3><p>å’Œå…¶ä»–è¯­è¨€ä¸­çš„ifè¡¨è¾¾å¼ä¸€æ ·ï¼Œé€šè¿‡<code>if</code>å…³é”®å­—åé¢çš„å£°æ˜ï¼ŒæŒ‡å®šæ¡ä»¶åŒ¹é…åçš„æ“ä½œï¼ŒåŒæ ·ä¹Ÿæ”¯æŒ<code>else</code>å’Œ<code>else if</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> number <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is less than 5"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> number <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is equal to 5"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is greater than 5"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li><p><code>if</code>ä½œä¸ºè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨letä¸­ä½¿ç”¨è¾¾åˆ°ä¸‰å…ƒè¡¨è¾¾å¼çš„æ•ˆæœ</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">if</span> number <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"a -&gt; {}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>1</code>ä¸­è¿™ç§è¡¨è¾¾å¼è¦å¯ä»¥ä½¿ç”¨ï¼Œæœ‰ä¸ªå‰æå°±æ˜¯æ¯ä¸ªè¡¨è¾¾å¼è¿”å›å€¼çš„ç±»å‹ï¼Œéœ€è¦ç›¸åŒï¼Œä¸ç„¶åœ¨ç¼–è¯‘æ—¶ï¼Œrustç¼–è¯‘å™¨ä¼šæŠ¥é”™</p></li></ul><h3 id="2-ä½¿ç”¨Loopæ¥å®ç°é‡å¤"><a href="#2-ä½¿ç”¨Loopæ¥å®ç°é‡å¤" class="headerlink" title="2. ä½¿ç”¨Loopæ¥å®ç°é‡å¤"></a>2. ä½¿ç”¨Loopæ¥å®ç°é‡å¤</h3><p>rustä¸­æä¾›äº†ä¸‰ç§å¾ªç¯çš„æ–¹å¼ï¼ŒåŒ…æ‹¬<code>loop</code>, <code>while</code>å’Œ<code>for</code>ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ¯ä¸€ç§çš„ç”¨æ³•å’Œå†™æ³•</p><h4 id="loopå¾ªç¯"><a href="#loopå¾ªç¯" class="headerlink" title="loopå¾ªç¯"></a>loopå¾ªç¯</h4><p>loopå¾ªç¯çš„ç‰¹ç‚¹æ˜¯ï¼Œä¸ä¼šä¸»åŠ¨ç»“æŸå¾ªç¯ï¼Œç›´åˆ°ä½¿ç”¨äººæ‰‹åŠ¨åœæ­¢ï¼ˆè°ƒç”¨<code>break</code>æŒ‡ä»¤ï¼‰æˆ–è€…ç›´æ¥è¿è¡Œ<code>ctrl + C</code>æ‰ä¼šåœæ­¢è¯¥å¾ªç¯ï¼Œå…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">loop</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"b =&gt;{}"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        b <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> b <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li><p>å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œrustä¸­æä¾›äº†<code>break</code>å’Œ<code>continue</code>å…³é”®å­—ï¼Œç”¨æ¥åœæ­¢å¾ªç¯å’Œè·³è¿‡åç»­ä»£ç è¿™ä¸¤ä¸ªæ“ä½œ</p></li><li><p>å¦‚æœéœ€è¦é€€å‡ºæŒ‡å®šçš„å¾ªç¯ï¼Œå¯ä»¥å°†loopçš„çš„è¿”å›å€¼æ‹¿åˆ°ï¼Œå¹¶é€šè¿‡breakæ¥ä¸­ä¸­æ–­</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">loopExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span>  count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token lifetime-annotation symbol">'loop_rlt</span><span class="token punctuation">:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"count -&gt; {}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> <span class="token keyword">mut</span> inner_count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                <span class="token keyword">loop</span> <span class="token punctuation">{</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"inner count -&gt;{}"</span><span class="token punctuation">,</span> inner_count<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> inner_count <span class="token operator">==</span> <span class="token number">8</span> <span class="token punctuation">{</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> inner_count <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> count <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">'loop_rlt</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                        inner_count <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        count <span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// è¿è¡Œç»“æœ</span><span class="token comment">// count -&gt; 0</span><span class="token comment">// inner count -&gt;10</span><span class="token comment">// inner count -&gt;9</span><span class="token comment">// inner count -&gt;8</span><span class="token comment">// count -&gt; 1</span><span class="token comment">// inner count -&gt;10</span><span class="token comment">// inner count -&gt;9</span><span class="token comment">// inner count -&gt;8</span><span class="token comment">// count -&gt; 2</span><span class="token comment">// inner count -&gt;10</span><span class="token comment">// inner count -&gt;9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>loopè¿”å›çš„å€¼éœ€è¦é€šè¿‡<code>' </code>åŠ ä¸Šå˜é‡ååŠ ä¸Š<code>:</code>æ¥æ ‡æ³¨è¿™æ˜¯ä¸€ä¸ªå¾ªç¯æ ‡è®°ï¼Œè¿™æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œä¾‹å¦‚ä¸Šè¿°çš„<code>'loop_rlt</code>ï¼Œè¿™æ ·é€šè¿‡<code>continue</code>å’Œ<code>break</code>æ¥é€€å‡ºå’Œç»§ç»­å¾ªç¯</p></li><li><p>é€šè¿‡<code>let</code>å’Œ<code>break</code>å¯ä»¥è·å–breakæœ€åæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å‡½æ•°å€¼</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">loop_return_value</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> loop_value <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>        count<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> count <span class="token operator">==</span> num <span class="token punctuation">{</span>            <span class="token keyword">break</span> count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> loop_value<span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> rlt<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token function">loop_return_value</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// rlt -&gt; 60</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"rlt -&gt; {}"</span><span class="token punctuation">,</span> rlt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h4><p><code>while</code>å¾ªç¯å’Œ<code>loop</code>ä¸­ï¼Œä¸€æ ·å¯ä»¥é€šè¿‡<code>break</code>æ¥è¿›è¡Œä¸­æ–­ï¼Œå…¶å†™æ³•ä¹Ÿå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å…¶ä»–è¯­è¨€ä¸­çš„<code>while</code>ç›¸ä¼¼</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> number <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}!"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>        number <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"LIFTOFF!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„ç‚¹</code></p><ul><li>å¦‚æœæ˜¯ä½¿ç”¨<code>while</code>å¾ªç¯éå†æ•°ç»„ç­‰æœ‰ç•Œçš„ç»“æ„ï¼Œå¯èƒ½éœ€è¦å¯¹åŠ¨æ€ç”Ÿæˆçš„indexåšå‡ºåˆ¤æ–­</li></ul><h4 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h4><p><code>for...inå¾ªç¯</code></p><p>é€šè¿‡whileå¾ªç¯æ¥ä¾¿åˆ©æ•°ç»„å¯èƒ½ä¼šäº§ç”Ÿè¶Šç•Œçš„é—®é¢˜ï¼Œä¸ºäº†é¿å…è¶Šç•Œå¯ä»¥é€šè¿‡<code>for...in``çš„æ–¹å¼æ¥è¿›è¡Œ</code>éå†ï¼Œä¾¿ä¸ä¼šæœ‰è¶Šç•Œçš„é—®é¢˜ï¼Œå› ä¸ºåœ¨whileä¸­æˆ‘ä»¬æ§åˆ¶indexæ˜¯åŠ¨æ€çš„ä¸ç¨³å®šã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">for_loop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> elem <span class="token keyword">in</span> a <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop for -&gt; {}"</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>åˆ©ç”¨Rangeå’Œfor..inçš„ç»„åˆæ¥è¿›è¡Œå¾ªç¯</code></p><p>é€šè¿‡<code>for...in</code>é™¤äº†å®ç°å¯¹é›†åˆç±»å‹çš„æ•°æ®ç»“æ„è¿›è¡Œéå†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°å¯¹whileé‚£æ ·çš„å¤šæ¬¡å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>range</code>åŠ <code>for...in</code>å¾ªç¯çš„æ–¹å¼</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">for_loop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> elem <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"item -&gt; {}"</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// item -&gt; 1</span>    <span class="token comment">// item -&gt; 2</span>    <span class="token comment">// ...</span>    <span class="token comment">/// item -&gt; 99</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸Šè¿°æ–¹å¼å› ä¸ºæ˜¯1..100æ‰€ä»¥åŒºé—´æ˜¯[1, 100)ï¼Œå¦‚æœæƒ³è¦åŒé—­çš„åŒºé—´ï¼Œå†™æ³•åº”è¯¥æ˜¯(1..=100)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å˜é‡ </category>
          
          <category> æ•°æ®ç±»å‹ </category>
          
          <category> å‡½æ•° </category>
          
          <category> æ³¨é‡Š </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cargoä»‹ç»</title>
      <link href="/2022/12/29/cargo-jie-shao/"/>
      <url>/2022/12/29/cargo-jie-shao/</url>
      
        <content type="html"><![CDATA[<p>cargoæ˜¯ä¸€ä¸ªæ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å·¥å…·,ç”¨æ¥ç®¡ç†rustå·¥ç¨‹å’Œå¤„ç†è®¸å¤šä»»åŠ¡ï¼ˆæ„å»ºä»£ç ã€ä¸‹è½½åŒ…ï¼‰,cargoåœ¨å®‰è£…rustçš„ç¯å¢ƒæ—¶ï¼Œä¼šè‡ªåŠ¨å®‰è£…ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¯ï¼Œç›´æ¥è°ƒç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ä»¥ç›´æ¥çœ‹åˆ°å¯¹åº”çš„cargoç‰ˆæœ¬</span><span class="token function">cargo</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="cargoå·¥ç¨‹çš„åˆ›å»º"><a href="#cargoå·¥ç¨‹çš„åˆ›å»º" class="headerlink" title="cargoå·¥ç¨‹çš„åˆ›å»º"></a>cargoå·¥ç¨‹çš„åˆ›å»º</h2><ol><li>åˆ›å»º</li></ol><p>ä½¿ç”¨<code>cargo new [projectName]</code>æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> new blog_cargo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://kun.nwyp123.com/20221229144156.png"></p><ol start="2"><li>ç›®å½•è§£æ</li></ol><p>åˆ›å»ºçš„ç›®å½•åŒ…æ‹¬ï¼š</p><ul><li>cargo.tomlï¼šç”¨äºå®šä¹‰åŒ…å’Œä¿¡æ¯<code>[package]</code>å’Œä¾èµ–<code>[dependencies]</code></li><li>æºæ–‡ä»¶ç›®å‰æ˜¯æ”¾åœ¨srcçš„ç›®å½•ä¸‹çš„</li></ul><ol start="3"><li>tomlæ–‡ä»¶ä¸­éœ€è¦æ³¨æ„çš„ç‚¹</li></ol><p>[package]ä¸‹é¢çš„ä¸€äº›é…ç½®:</p><ul><li>buildï¼šç”¨äºæŒ‡å®šbuildæ¥æŒ‡å®šè¿™ä¸ªåŒ…ç”¨æºç çš„æ–¹å¼ç¼–è¯‘</li></ul><blockquote><p>æ¯”å¦‚åœ¨rustä¸­å¼•ç”¨äº†æ¯”å¦‚Cçš„åº“ï¼Œè¿™äº›ä¸œè¥¿ç¼–è¯‘å°±æ”¾åœ¨ä¸€ä¸ªbuild.rsä¸­ï¼Œä¼šé€šè¿‡æºç çš„æ–¹å¼è¿›è¡Œç¼–è¯‘</p></blockquote><ul><li>includeå’Œexcludeï¼šç”¨æ¥æŒ‡å®šé‚£äº›åŒ…éœ€è¦è¢«æ‰“åŒ…æˆ–å‘å¸ƒï¼Œå¯ä»¥é€šè¿‡<code>carge package --list</code>æ¥æŸ¥çœ‹</li><li>publish: ç”¨æ¥æŒ‡å®šåŒ…æ˜¯å¦å‘å¸ƒåˆ°åŒ…ä»“åº“ï¼Œ<code>ä¿æŠ¤åŒ…çš„ç§æœ‰æ€§</code></li></ul><h2 id="ä½¿ç”¨cargoæ„å»ºå’Œè·‘rustå·¥ç¨‹"><a href="#ä½¿ç”¨cargoæ„å»ºå’Œè·‘rustå·¥ç¨‹" class="headerlink" title="ä½¿ç”¨cargoæ„å»ºå’Œè·‘rustå·¥ç¨‹"></a>ä½¿ç”¨cargoæ„å»ºå’Œè·‘rustå·¥ç¨‹</h2><ol><li>æ„å»ºrustå·¥ç¨‹</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> build<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>è¿è¡Œcargoå·¥ç¨‹</li></ol><p>æ„å»ºæˆåŠŸä¹‹åçš„æ–‡ä»¶éƒ½åœ¨<code>target/debug/hello_cargo</code>ä¸‹ï¼Œç›´æ¥è¿è¡Œç›®å½•ä¸‹çš„<code>exe</code>æ–‡ä»¶ä¹Ÿå¯ä»¥è¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.<span class="token punctuation">\</span>target<span class="token punctuation">\</span>debug<span class="token punctuation">\</span>hello_cargo.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥é€šè¿‡cargoæ¥è¿è¡Œå¯¹åº”çš„exeæ‰“åŒ…æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨æ‰§è¡Œcargo runçš„æ—¶å€™æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹ï¼š</p><ul><li>æºæ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œç›´æ¥æ‰§è¡Œcargo buildå‡ºæ¥çš„æ–‡ä»¶</li><li>å¦‚æœæºæ–‡ä»¶äº§ç”Ÿäº†å˜åŒ–ï¼Œä¼šå…ˆç¼–è¯‘ï¼Œç„¶åå†æ‰§è¡Œ</li><li>è¿™é‡Œå¯ä»¥é€šè¿‡<code>cargo check</code>æ¥æ£€éªŒå½“å‰ç‰ˆæœ¬çš„ç¼–è¯‘åçš„ä»£ç ï¼Œæ˜¯å¦è¿˜æœ‰æ›´æ–°ä¸ºç¼–è¯‘çš„ç‰ˆæœ¬</li></ul><ol start="3"><li>æ„å»ºå‘å¸ƒç‰ˆæœ¬</li></ol><p>é€šè¿‡<code>--release</code>æ¥æŒ‡å®šæ„å»ºçš„ç‰ˆæœ¬ä¸ºå‘å¸ƒç‰ˆæœ¬ï¼Œé€šè¿‡<code>release</code>æ¥å‘å¸ƒï¼Œä¼šåšå¾ˆå¤šä¼˜åŒ–ï¼Œä½¿rustä»£ç è¿è¡Œæ›´å¿«ï¼Œä½†ä¹Ÿä¼šè®©<code>æ„å»ºæ—¶é—´æ›´é•¿</code>ï¼Œå¦å¤–æ„å»ºå‘å¸ƒçš„æ—¶å€™ï¼Œè¿™ä¸ªåœ°æ–¹ç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨targetä¸‹çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä»‹ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> cargo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rustæ•°æ®ç»“æ„</title>
      <link href="/2022/12/15/rust-shu-ju-jie-gou/"/>
      <url>/2022/12/15/rust-shu-ju-jie-gou/</url>
      
        <content type="html"><![CDATA[<p><strong>Rust</strong> çš„ <strong>Vec</strong> å…¶å®æ˜¯åŠ¨æ€æ•°ç»„, å¾ˆå¤šè¯­è¨€å†…ç½®åŠ¨æ€æ•°ç»„, è­¬å¦‚ <strong>JavaScript</strong> <strong>Python</strong>è¿™ç±», åƒ <strong>Rust</strong> è¿™ç§å…·æœ‰å†…å­˜æ§åˆ¶èƒ½åŠ›çš„è¯­è¨€, å°±é€‰æ‹©äº†æ ‡å‡†åº“å†…ç½®åŠ¨æ€æ•°ç»„.</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token macro property">dbg!</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>  v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><p>ç°åœ¨ç›´æ¥å†™ä¸€ä¸‹ <strong>Rust</strong> åŠ¨æ€æ•°ç»„ç›´è§‚å®ç°</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>  len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·ç›´æ¥ç¼–è¯‘èƒ½é€šè¿‡, ä½†æ˜¯ <code>ptr</code> è¿™ä¸ªè£¸æŒ‡é’ˆä¸èƒ½è®© <code>Drop check</code> æ­£å¸¸å·¥ä½œ, å› ä¸ºç›´æ¥åœ¨è¿™é‡Œä½¿ç”¨è£¸æŒ‡é’ˆ <code>Drop</code> æ£€æŸ¥å™¨ä¼šè®¤ä¸ºä½ æ²¡æœ‰æŒæœ‰ä»»ä½•å€¼, å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ <code>Unique&lt;T&gt;</code> å¤„ç†ç¥¼æŒ‡é’ˆ <code>*mut T</code>, é€šè¿‡å®ƒå†…éƒ¨çš„ <code>PhantomData</code> æ¥å¸®åŠ© <code>Drop check</code> å·¥ä½œ.</p><blockquote><p><code>Unique&lt;T&gt;</code> å¯ä»¥å°è£…ç¥¼æŒ‡é’ˆ</p><ul><li><code>T</code> æ˜¯å¯å˜çš„</li><li>å¯ä»¥è¿›è¡Œ <code>drop</code> æ£€æŸ¥</li><li><code>T</code> å®ç°äº† <code>Send/Sync</code>, è¯¥æŒ‡é’ˆä¹Ÿå…·å¤‡ <code>Send/Sync</code> ç‰¹æ€§, ç­‰äºè®²çº¿ç¨‹å®‰å…¨</li><li>æŒ‡é’ˆå…·å¤‡éç©ºæ€§</li></ul></blockquote><p>æ—¢ç„¶å¦‚æ­¤è‡ªå·±å®ç°ä¸€ä¸ªå§, è§£ææºç è‡ªå·±å†™ä¸ä¼šæµªè´¹ä»€ä¹ˆæ—¶é—´, è¿˜èƒ½ä½“ä¼šåˆ«äººçš„è®¾è®¡, é¡ºé“å®ç°ä¸€ä¸‹ <code>Send/Sync</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>marker<span class="token punctuation">::</span></span><span class="token class-name">PhantomData</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  _marker<span class="token punctuation">:</span> <span class="token class-name">PhantomData</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">Send</span> <span class="token keyword">for</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">Sync</span> <span class="token keyword">for</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token attribute attr-name">#[inline]</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token operator">!</span>ptr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token class-name">MyUnique</span> <span class="token punctuation">{</span>          ptr<span class="token punctuation">:</span> ptr <span class="token keyword">as</span> _<span class="token punctuation">,</span>          _marker<span class="token punctuation">:</span> <span class="token class-name">PhantomData</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token attribute attr-name">#[inline]</span>  <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token keyword">fn</span> <span class="token function-definition function">as_ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>ptr <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸ª <code>?Sized</code> çš„ <code>trait bound</code> è¿™ç©æ„å…¶å®æ˜¯æŒ‡å®šä¸€ä¸‹æ³›å‹çš„ç‰¹æ€§, æ„æ€æ˜¯æŒ‡ç¼–è¯‘æ—¶ç¡®å®šå¤§å°, é»˜è®¤æƒ…å†µä¸‹ç›´æ¥å†™ <code>T</code> å°±æ˜¯ <code>Sized</code> äº†, åŠ äº†ä¸ªé—®å·å°±ä¼šæ”¾å®½çº¦æŸçš„èŒƒå›´, ç¼–è¯‘æ—¶ä¸ç¡®å®šå¤§å°çš„ä¹Ÿè¢«æ¥å—. åŠ ä¸Š <code>#[inline]</code> è¿™ä¸ªå±æ€§å°±è¡¨ç¤ºå†…è”å‡½æ•°, å› ä¸ºè¿™å‡ ä¸ªå‡½æ•°å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨åˆ°, å†…è”ä¼šå¸¦ç‚¹åŠ é€Ÿæ•ˆæœ.</p><h2 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h2><p>ä¹‹åæˆ‘ä»¬è¦è€ƒè™‘åˆå§‹åŒ–å®¹å™¨äº†, å¦‚æœå®¹å™¨æ”¾äº†ä¸œè¥¿è‚¯å®šä¼šå¼€è¾Ÿå†…å­˜ç©ºé—´, ä½†æ˜¯åˆå§‹åŒ–çš„æƒ…å†µå®¹å™¨åº”è¯¥æ˜¯ç©ºçš„, æ—¢ç„¶æ˜¯ç©ºçš„è‚¯å®šä¸ä¼šåˆ†é…å†…å­˜, é‚£å°±ç”¨ <code>MyUnique</code> å»ºä¸ªç©ºçš„ä¸œè¥¿</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">imp<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">&gt;</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token attribute attr-name">#[inline]</span>  <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">new_unchecked</span><span class="token punctuation">(</span>ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">MyUnique</span> <span class="token punctuation">{</span>      ptr<span class="token punctuation">:</span> ptr <span class="token keyword">as</span> _<span class="token punctuation">,</span>      _marker<span class="token punctuation">:</span> <span class="token class-name">PhantomData</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token keyword">fn</span> <span class="token function-definition function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>  cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>  len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"We're not ready to handle ZSTs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">MyVec</span> <span class="token punctuation">{</span>      ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      len<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>      cap<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å†™ä¸€ä¸‹å†…å­˜åˆ†é…ç›¸å…³çš„ä»£ç , æ—¢ç„¶æˆ‘ä»¬éœ€è¦åˆ†é…å†…å­˜, è¿™å—å…¶å®æ²¡ä»€ä¹ˆä¸œè¥¿, å°±æ˜¯è¯»ä¸€ä¸‹å†…å­˜åˆ†é…çš„æ–‡æ¡£ç„¶åä½¿ç”¨èµ·æ¥, å½“ç„¶ä¹Ÿè¦è€ƒè™‘å¯¹é½. å…¶å®è¿™æ˜¯ä¸ªæ‰©å®¹å¤„ç†</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>alloc<span class="token punctuation">::</span></span><span class="token punctuation">{</span>handle_alloc_error<span class="token punctuation">,</span> realloc<span class="token punctuation">,</span> <span class="token class-name">Layout</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>mem<span class="token punctuation">;</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">grow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> new_cap <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> layout <span class="token operator">=</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> layout<span class="token punctuation">,</span> layout<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> ptr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">handle_alloc_error</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">from_size_align_unchecked</span><span class="token punctuation">(</span>            new_cap <span class="token operator">*</span> elem_size<span class="token punctuation">,</span>            <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">Self</span> <span class="token punctuation">{</span>        ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span>ptr <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span>        cap<span class="token punctuation">:</span> new_cap<span class="token punctuation">,</span>        len<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="push-amp-pop"><a href="#push-amp-pop" class="headerlink" title="push &amp; pop"></a>push &amp; pop</h2><p>ä¸Šé¢å·²ç»åšåˆ°èƒ½åˆ†é…å†…å­˜äº†, æ¥ä¸‹æ¥è‡ªç„¶æ˜¯å®ç°åŸºæœ¬çš„åŠŸèƒ½.</p><p>å…ˆåˆ†æä¸€æ³¢ <strong>push</strong> çš„è¡Œä¸º, <strong>push</strong> å°±æ˜¯å¾€åŠ¨æ€æ•°ç»„æ·»åŠ å…ƒç´ , å¦‚æœæ»¡äº†å°±éœ€è¦é‡æ–°åˆ†é…å†…å­˜, å…¶å®å°±æ˜¯è°ƒç”¨ <code>grow</code>, æ¯æ¬¡æ·»åŠ å…ƒç´ åé•¿åº¦ä¹Ÿè¦ç›¸åº” <code>+1</code>, è¿˜éœ€è¦å¯¹ç›¸åº”åœ°å€å†™å…ƒç´ . å†™å…¥è¡Œä¸ºç”¨ <code>std::ptr</code> çš„ <code>write</code> å‡½æ•°æ¥å¤„ç†, ç›¸åº”çš„ <code>pop</code> ä¹Ÿå¾ˆå¥½ç†è§£, åªè¦æŠŠæœ€åä¸€ä¸ªè¯»å–å‡ºæ¥åŒæ—¶æŠŠé•¿åº¦ <code>-1</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>mem<span class="token punctuation">,</span> ptr<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> element<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å›æ”¶èµ„æº"><a href="#å›æ”¶èµ„æº" class="headerlink" title="å›æ”¶èµ„æº"></a>å›æ”¶èµ„æº</h2><p><strong>Rust</strong> çš„æœºåˆ¶è®©æˆ‘ä»¬å¤„ç†è¿™ä¸ªé—®é¢˜éå¸¸ç®€å•, åªéœ€è¦å®ç°ä¸€ä¸‹ <code>trait Drop</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> elem_size <span class="token operator">=</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> elem_size <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token function">dealloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§£å¼•ç”¨"><a href="#è§£å¼•ç”¨" class="headerlink" title="è§£å¼•ç”¨"></a>è§£å¼•ç”¨</h2><p>è‡³æ­¤, å·²ç»å®ç°äº†ä¸€ä¸ªç®€å•çš„æ•°æ®ç»“æ„, ä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æ³•è·Ÿ <code>slice</code> ç›¸é€š, çœŸå®çš„ <strong>Vec</strong> ä¸æ˜¯è¿™æ ·çš„, æ‰€ä»¥å½“ä¸‹æˆ‘ä»¬åº”è¯¥å®ç°ä¸€ä¸‹è‡ªåŠ¨è§£å¼•ç”¨, åªè¦å®ç°äº†ä¸‹é¢è¿™äº›ä¸œè¥¿, æˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>slice</code> çš„æä¾›çš„æ¥å£äº†</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deref</span><span class="token punctuation">,</span> <span class="token class-name">DerefMut</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token namespace">std<span class="token punctuation">::</span>slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DerefMut</span> <span class="token keyword">for</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">deref_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token namespace">std<span class="token punctuation">::</span>slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ’å…¥è·Ÿåˆ é™¤"><a href="#æ’å…¥è·Ÿåˆ é™¤" class="headerlink" title="æ’å…¥è·Ÿåˆ é™¤"></a>æ’å…¥è·Ÿåˆ é™¤</h2><h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><p>æ’å…¥çš„è¡Œä¸ºå…¶å®å°±æ˜¯æŠŠå½“å‰è¦æ’å…¥çš„ä½ç½®ä¹‹åçš„æ‰€æœ‰å…ƒç´ åˆ†åˆ«å‘å³ç§»åŠ¨ä¸€ä½, è­¬å¦‚ä¸€ä¸ªæ•°ç»„ <code>[1, 2, 3]</code>, æˆ‘è¦æŠŠ <code>10</code> æ’å…¥ ç´¢å¼• <code>1</code> ä½ç½®(å°±æ˜¯å…ƒç´  <code>2</code>), é‚£ä¹ˆ <code>10</code> çš„ä¸‹æ ‡å°±æ˜¯ <code>1</code>, åŒæ—¶å…ƒç´  <code>2</code> è·Ÿ <code>3</code> çš„ä¸‹æ ‡å°±æ˜¯ <code>2</code> è·Ÿ <code>3</code>, æœ€åå°±å˜æˆäº† <code>[1, 10, 2, 3]</code>.</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> element<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> index <span class="token operator">&lt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token punctuation">{</span>        <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>åˆ é™¤çš„è¡Œä¸ºä¹Ÿå¾ˆå¥½ç†è§£, è·Ÿæ’å…¥åç€æ¥å°±å¯ä»¥äº†, åªè¦æŠŠè¦åˆ é™¤çš„ä½ç½®ä¹‹åæ‰€æœ‰çš„ä¸‹æ ‡å‘å·¦ç§»åŠ¨ä¸€ä½, è­¬å¦‚ç°åœ¨æŠŠä¹‹å‰æ’å…¥åçš„æ•°ç»„ <code>[1, 10, 2, 3]</code> <code>10</code> ç»™åˆ é™¤æ‰, <code>10</code> æ‰€åœ¨çš„ä¸‹æ ‡æ˜¯ <code>1</code>, åé¢çš„å…ƒç´ çš„ä¸‹æ ‡åˆ†åˆ«æ˜¯ <code>2</code> è·Ÿ <code>3</code>, åé¢çš„ <code>-1</code> å°±å®Œæˆäº†.</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">,</span> <span class="token string">"index out of bounds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>      result    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="IntoIter"><a href="#IntoIter" class="headerlink" title="IntoIter"></a>IntoIter</h2><p>è¿™è¶Ÿå¼€å§‹å¤„ç†ä¸€ä¸‹ <strong>Vec</strong> æ‰æœ‰çš„è¿­ä»£å™¨, å…¶å®åªè¦å®ç°äº†è‡ªåŠ¨è§£å¼•ç”¨çš„ <code>trait</code>, å°±å¯ä»¥ä½¿ç”¨ <code>slice</code> çš„ <code>iter</code> è¿˜æœ‰ <code>iter_mut</code>, ä½†æ˜¯ <code>slice</code> æ˜¯æ²¡æœ‰ <code>into_iter</code> çš„, æ‰€ä»¥æˆ‘ä»¬å¾—å®ç°ä¸€ä¸‹.<br>ç°åœ¨æœ‰ä¸ªé—®é¢˜, æ—¢ç„¶å·²ç»æœ‰äº† <code>slice</code> çš„è¿­ä»£å™¨åŠŸèƒ½äº†, æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å®ç°è¿™ä¸ª <code>IntoIter</code>?<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ª <strong>Vec</strong> å¯ä»¥ç›´æ¥ç”¨ <code>for</code> è¿›è¡Œå¾ªç¯éå†, åŸå› å°±æ˜¯åªè¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»å‹å®ç°äº† <code>IntoIter</code> å°±å…·å¤‡èƒ½è¢« <code>for</code> è¿­ä»£çš„èƒ½åŠ›</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> v <span class="token punctuation">{</span>  <span class="token macro property">dbg!</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨å¯ä»¥ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥å¤„ç†è¿­ä»£å™¨çš„æ“ä½œ, ä¸€ä¸ªåœ¨å¼€å¤´, ä¸€ä¸ªåœ¨ç»“å°¾åé¢é‚£ä¸€ä¸ª, åªè¦å¼€å¤´çš„æŒ‡é’ˆè·Ÿç»“å°¾åä¸€ä¸ªçš„æŒ‡é’ˆåœ°å€ç›¸åŒ, å°±è¡¨æ˜è¿­ä»£ç»“æŸäº†.</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> sth<span class="token punctuation">]</span> <span class="token operator">^</span>              <span class="token operator">^</span><span class="token keyword">start</span>           <span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æ¥å»ºç«‹ä¸ªè¿­ä»£å™¨ç»“æ„, å¤§æ¦‚é•¿è¿™æ ·</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  start<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  end<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶åç»­è¿˜è¦å¤„ç†å†…å­˜ç›¸å…³çš„, æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠ <strong>Vec</strong> åˆ†é…çš„ç©ºé—´è®¯æ¯ä¿å­˜ä¸€ä¸‹, å½“ç„¶è¿˜è¦æŠŠ <code>MyVec</code> è½¬åŒ–æˆ <code>IntoIter</code> ç±»å‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  start<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  end<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  buf<span class="token punctuation">:</span> <span class="token class-name">MyUniuqe</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>  cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">into_iter</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token class-name">MyVec</span> <span class="token punctuation">{</span> ptr<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> len <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>    <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">forget</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token class-name">IntoIter</span> <span class="token punctuation">{</span>        buf<span class="token punctuation">:</span> ptr<span class="token punctuation">,</span>        cap<span class="token punctuation">,</span>        start<span class="token punctuation">:</span> ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        end<span class="token punctuation">:</span> <span class="token keyword">if</span> cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜è¦å®ç°ä¸€ä¸‹è¿­ä»£å™¨, <code>size_hint</code> æ˜¯ä»¿å†™æ ‡å‡†åº“çš„, ä¸»è¦ä½œç”¨æ˜¯è¡¨è¾¾å‰©ä½™å¯è¿­ä»£å…ƒç´ æ•°é‡ä¸Šä¸‹ç•Œ, ä¸‹é¢æ˜¯ <code>next</code> ç›¸å…³çš„æ“ä½œ</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">size_hint</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span>len<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ <code>next_back</code> çš„æ“ä½œ</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DoubleEndedIterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†å¤„ç†å†…å­˜ç›¸å…³çš„, æˆ‘ä»¬è¦ç»™ <code>IntoIter</code> å®ç°ä¸€ä¸‹ <code>Drop trait</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token function">dealloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buf<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="RawVec"><a href="#RawVec" class="headerlink" title="RawVec"></a>RawVec</h2><p>ç°åœ¨ç»§ç»­é‡æ„ä»£ç , å› ä¸ºæˆ‘ä»¬åˆ†åˆ«ç»™ <code>IntoIter</code> è·Ÿ <code>MyVec</code> å®ç°äº†ä¸€é <code>Drop</code>, æ‰€ä»¥é‡æ„ä¸€ä¸‹ä»£ç æ˜¯æœ‰å¿…è¦çš„</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>  len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> element<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>buf<span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> element<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>index <span class="token operator">&lt;=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">,</span> <span class="token string">"index out of bounds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>buf<span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> index <span class="token operator">&lt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token punctuation">{</span>        <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len<span class="token punctuation">,</span> <span class="token string">"index out of bounds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>len <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>      result    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">struct</span> <span class="token type-definition class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  start<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  end<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  _buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">size_hint</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span>len<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DoubleEndedIterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">struct</span> <span class="token type-definition class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>  cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">RawVec</span> <span class="token punctuation">{</span>      ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      cap<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">grow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> new_cap <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> layout <span class="token operator">=</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> layout<span class="token punctuation">,</span> layout<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> ptr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">handle_alloc_error</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">from_size_align_unchecked</span><span class="token punctuation">(</span>            new_cap <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">Self</span> <span class="token punctuation">{</span>        ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span>ptr <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span>        cap<span class="token punctuation">:</span> new_cap<span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token function">dealloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŠ½å–è¿­ä»£æ“ä½œ"><a href="#æŠ½å–è¿­ä»£æ“ä½œ" class="headerlink" title="æŠ½å–è¿­ä»£æ“ä½œ"></a>æŠ½å–è¿­ä»£æ“ä½œ</h2><p>ç°åœ¨æˆ‘ä»¬åŸºæœ¬çš„ <strong>Vec</strong> ç»“æ„å·²ç»åšå‡ºæ¥äº†, ç°åœ¨ä»¿ç…§ä¹‹å‰çš„ <code>RawVec</code> åšä¸€ä»½å°è£….</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  start<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span>  end<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">RawValIter</span> <span class="token punctuation">{</span>      start<span class="token punctuation">:</span> slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      end<span class="token punctuation">:</span> <span class="token keyword">if</span> slice<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">isize</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">size_hint</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span>len<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DoubleEndedIterator</span> <span class="token keyword">for</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ”¹é€ ä¸€ä¸‹è¿­ä»£å™¨, ç°åœ¨åªè¦åœ¨å„å‡½æ•°å†…éƒ¨è°ƒç”¨ <code>RawValIter</code> çš„å®ç°å°±è¡Œäº†</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  _buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>  iter<span class="token punctuation">:</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">size_hint</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>iter<span class="token punctuation">.</span><span class="token function">size_hint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DoubleEndedIterator</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>iter<span class="token punctuation">.</span><span class="token function">next_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">IntoIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>iter <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤„ç†-Zero-Sized-Types"><a href="#å¤„ç†-Zero-Sized-Types" class="headerlink" title="å¤„ç† Zero-Sized Types"></a>å¤„ç† Zero-Sized Types</h2><p>é€šå¸¸æƒ…å†µä¸‹, <strong>Rust</strong> æ˜¯ä¸éœ€è¦å¤„ç† <strong>Zero-Sized Types</strong> çš„, ä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æœ‰å¤§é‡å…³äºè£¸æŒ‡é’ˆçš„æ“ä½œ, å‡å¦‚ç»™åˆ†é…å™¨ä¼ é€’ zst, ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º, å¯¹ <code>zst</code> è£¸æŒ‡é’ˆè¿›è¡Œ <code>offset</code> æ˜¯ä¸€ä¸ª <code>no-op</code> è¡Œä¸º.</p><p>å…ˆæŠŠ <code>new</code> å‡½æ•°çš„ <code>cap</code> å¤„ç†ä¸€ä¸‹, å¦‚æœæ˜¯ <code>size_of</code> å¤„ç†å‡ºæ¥çš„ <code>T</code> æ˜¯ <code>0</code> çš„æƒ…å†µ, å°±ç»™ <code>0</code> æŒ‰ä½å–å(<code>usize::MAX</code>), å› ä¸º <code>T</code> çš„ <code>size_of</code> ä¸º <code>0</code> å…¶å®ä¸éœ€è¦å¼€è¾Ÿå†…å­˜, åæ­£ä½ å­˜è¿›æ¥çš„éƒ½æ˜¯ <code>0</code>, é€»è¾‘ä¸Šä¸ä¼šå ç”¨å†…å­˜.</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> cap <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token operator">!</span><span class="token number">0</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token class-name">RawVec</span> <span class="token punctuation">{</span>      ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      cap<span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±æ˜¯ <code>grow</code> å‡½æ•°ä¹Ÿå¤„ç†ä¸€ä¸‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>  <span class="token keyword">fn</span> <span class="token function-definition function">grow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> elem_size <span class="token operator">=</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span>elem_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"capacity overflow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> new_cap <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> layout <span class="token operator">=</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> layout<span class="token punctuation">,</span> layout<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> ptr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">handle_alloc_error</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">from_size_align_unchecked</span><span class="token punctuation">(</span>          new_cap <span class="token operator">*</span> elem_size<span class="token punctuation">,</span>          <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">Self</span> <span class="token punctuation">{</span>        ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span>ptr <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span>        cap<span class="token punctuation">:</span> new_cap<span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>RawVec</code> çš„ <code>Drop</code> ä¹Ÿéœ€è¦å¤„ç†, å…¶å®ä¹‹å‰çš„å®ç°ä¹Ÿå¯ä»¥, ä½†æ˜¯å‡è£…å¯¹é½ä¸€ä¸‹å§!</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> elem_size <span class="token operator">=</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> elem_size <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token function">dealloc</span><span class="token punctuation">(</span>          <span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span>          <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">from_size_align_unchecked</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap <span class="token operator">*</span> elem_size<span class="token punctuation">,</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ˜¯ <code>RawValIter</code> çš„ <code>zst</code> å¤„ç†</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">RawValIter</span> <span class="token punctuation">{</span>      start<span class="token punctuation">:</span> slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      end<span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">+</span> slice<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">const</span> _      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> slice<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        slice<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">isize</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿­ä»£å™¨ä¹Ÿå¤„ç†ä¸€ä¸‹, <code>size_hint</code> é™¤æ•°ä¸º <code>0</code> çš„æƒ…å†µéœ€è¦å¤„ç†</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>          <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">const</span> _        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token keyword">self</span><span class="token punctuation">.</span>start<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">size_hint</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> elem_size <span class="token operator">=</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">if</span> elem_size <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> elem_size <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span>len<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">DoubleEndedIterator</span> <span class="token keyword">for</span> <span class="token class-name">RawValIter</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">next_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>start <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token punctuation">{</span>      <span class="token class-name">None</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>          <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end <span class="token keyword">as</span> <span class="token keyword">usize</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">const</span> _        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="with-capacity"><a href="#with-capacity" class="headerlink" title="with_capacity"></a>with_capacity</h2><p>è¿™ä¸ªå®ç°ä¸€ä¸‹å·®ä¸å¤šç®—ç»“æŸäº†, å…ˆæŠŠ <code>MyVec</code> æ”¹ä¸€ä¸‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">with_capacity</span><span class="token punctuation">(</span>capacity<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MyVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token class-name">MyVec</span> <span class="token punctuation">{</span>      buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">,</span>      len<span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åç»™ <code>RawVec</code> æ·»åŠ ä¸ªæ¥å£</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> cap <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token operator">!</span><span class="token number">0</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token class-name">RawVec</span> <span class="token punctuation">{</span>      ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      cap<span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">with_capacity</span><span class="token punctuation">(</span>cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">RawVec</span><span class="token punctuation">::</span><span class="token function">allocate_in</span><span class="token punctuation">(</span>cap<span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">allocate_in</span><span class="token punctuation">(</span>cap<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">MyUnique</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> elem_size <span class="token operator">=</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span>elem_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"capacity overflow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>some_p<span class="token punctuation">)</span> <span class="token operator">=</span> p <span class="token punctuation">{</span>          <span class="token keyword">let</span> new_cap <span class="token operator">=</span> cap <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>          <span class="token keyword">let</span> layout <span class="token operator">=</span> <span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>some_p<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">,</span> layout<span class="token punctuation">,</span> layout<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">(</span>new_cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">array</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">(</span>cap<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> ptr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">handle_alloc_error</span><span class="token punctuation">(</span><span class="token class-name">Layout</span><span class="token punctuation">::</span><span class="token function">from_size_align_unchecked</span><span class="token punctuation">(</span>          new_cap <span class="token operator">*</span> elem_size<span class="token punctuation">,</span>          <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">align_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">Self</span> <span class="token punctuation">{</span>        ptr<span class="token punctuation">:</span> <span class="token class-name">MyUnique</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span>ptr <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span>        cap<span class="token punctuation">:</span> new_cap<span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">fn</span> <span class="token function-definition function">grow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>    <span class="token class-name">RawVec</span><span class="token punctuation">::</span><span class="token function">allocate_in</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cap<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ptr<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨å·²ç»æŠŠ <code>grow</code> æŠ½å–å‡ºæ¥, åŒæ—¶ç»™ <code>with_capacity</code> è°ƒç”¨</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æ€§èƒ½ä¼˜åŒ–</title>
      <link href="/2022/12/13/vue2-xing-neng-you-hua/"/>
      <url>/2022/12/13/vue2-xing-neng-you-hua/</url>
      
        <content type="html"><![CDATA[<p>æ€§èƒ½ä¼˜åŒ–åˆ†ä¸ºå››ä¸ªæ¨¡å—ï¼šä»£ç å±‚é¢çš„ä¼˜åŒ–ï¼Œæ‰“åŒ…å±‚é¢çš„ä¼˜åŒ–ï¼ŒæœåŠ¡å±‚é¢çš„ä¼˜åŒ–ï¼Œå›¾ç‰‡èµ„æºçš„ä¼˜åŒ–ã€‚ä¸ªæ•°åˆ†åˆ«ä¸º8ï¼Œ3ï¼Œ5ï¼Œ5ï¼ˆè®°ä½ä¸ªæ•°åä¸å®¹æ˜“æ¼å¿˜ï¼‰</p><h2 id="ä¸€ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–"><a href="#ä¸€ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–" class="headerlink" title="ä¸€ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–"></a>ä¸€ã€ä»£ç å±‚é¢çš„ä¼˜åŒ–</h2><p>å…±8ä¸ªï¼Œè®°ä½å¼€å¤´å­—ï¼Œè¿™æ ·æ–¹ä¾¿è®°å¿†ï¼šè·¯å‡½ç¼“è„šç›‘ï¼Œå¾ªæ´»å®¹</p><h3 id="1-è·¯ç”±æ‡’åŠ è½½"><a href="#1-è·¯ç”±æ‡’åŠ è½½" class="headerlink" title="1. è·¯ç”±æ‡’åŠ è½½"></a>1. è·¯ç”±æ‡’åŠ è½½</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "Home" */</span><span class="token string">'../components/layout/home.vue'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-å‡½æ•°å¼ç»„ä»¶"><a href="#2-å‡½æ•°å¼ç»„ä»¶" class="headerlink" title="2. å‡½æ•°å¼ç»„ä»¶"></a>2. å‡½æ•°å¼ç»„ä»¶</h3><p>å‡½æ•°å‹ç»„ä»¶ä¹Ÿè¢«ç§°ä¸ºæ— çŠ¶æ€ç»„ä»¶ï¼Œæ— ç”Ÿå‘½å‘¨æœŸï¼ˆæ„å‘³ç€é’©å­å‡½æ•°ä¸èƒ½ä½¿ç”¨ï¼‰ï¼Œæ— çŠ¶æ€å“åº”ï¼ˆmethodsä¸­çš„æ–¹æ³•ä¸èƒ½å“åº”ï¼‰ã€‚</p><p>åœ¨templateæ¨¡æ¿ä¸­å¢åŠ functionalå³å¯</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">functional</span><span class="token punctuation">&gt;</span></span>    &lt;el-table      :data="props.items"  //2.3.0ä¹‹å‰çš„Vueç‰ˆæœ¬éœ€è¦é€šè¿‡propsæ¥æ”¶ä¼ çš„å€¼ï¼Œä¹‹åçš„ç‰ˆæœ¬å¯çœç•¥      height="400"      border      @selection-change="props.handleSelectChange"    &gt;      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    <span class="token literal-property property">props</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"items"</span><span class="token punctuation">,</span><span class="token string">"handleSelectChange"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¼˜ç‚¹ï¼šæ— ç”Ÿå‘½å‘¨æœŸï¼Œæ¸²æŸ“å¿«ã€‚</p><h3 id="3-ç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼ˆ-keep-aliveï¼‰"><a href="#3-ç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼ˆ-keep-aliveï¼‰" class="headerlink" title="3. ç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼ˆ keep-aliveï¼‰"></a>3. ç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼ˆ keep-aliveï¼‰</h3><h3 id="4-è„šæœ¬å»¶è¿ŸåŠ è½½"><a href="#4-è„šæœ¬å»¶è¿ŸåŠ è½½" class="headerlink" title="4. è„šæœ¬å»¶è¿ŸåŠ è½½"></a>4. è„šæœ¬å»¶è¿ŸåŠ è½½</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>HTML4çš„deferæ˜¯â€œæ¸²æŸ“å®Œå†æ‰§è¡Œâ€ï¼ŒHTML5çš„asyncæ˜¯â€œä¸‹è½½å®Œå°±æ‰§è¡Œâ€ã€‚å¤šä¸ªdeferè„šæœ¬ï¼Œä¼šæŒ‰ç…§å®ƒä»¬åœ¨é¡µé¢å‡ºç°çš„é¡ºåºåŠ è½½ï¼Œè€Œå¤šä¸ªasyncè„šæœ¬ä¸èƒ½ä¿è¯åŠ è½½é¡ºåºï¼ˆå¦‚æœè„šæœ¬ä¹‹é—´æœ‰ç»§æ‰¿å…³ç³»ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨asyncï¼Œæ¯”å¦‚vueä¸vuexï¼‰</p><h3 id="5-ç›‘å¬äº‹ä»¶é”€æ¯"><a href="#5-ç›‘å¬äº‹ä»¶é”€æ¯" class="headerlink" title="5. ç›‘å¬äº‹ä»¶é”€æ¯"></a>5. ç›‘å¬äº‹ä»¶é”€æ¯</h3><p>Vueç»„ä»¶é”€æ¯æ—¶ï¼ˆåˆ‡æ¢è·¯ç”±æ—¶ï¼‰ï¼Œä¼šè‡ªåŠ¨æ¸…ç†å®ƒä¸å…¶ä»–å®ä¾‹çš„è¿æ¥ï¼Œè§£ç»‘å®ƒçš„å…¨éƒ¨æŒ‡ä»¤åŠäº‹ä»¶ç›‘å¬ã€‚å¦‚æœä½¿ç”¨åŸç”Ÿçš„æ–¹å¼ï¼Œæ¯”å¦‚addEventListenerï¼Œäº‹ä»¶æ€»çº¿ç­‰æ–¹å¼æ˜¯ä¸ä¼šè‡ªåŠ¨é”€æ¯çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶é”€æ¯æ—¶ï¼ˆbeforeDestroyæˆ–destroyedç”Ÿå‘½å‘¨æœŸï¼‰æ‰‹åŠ¨ç§»é™¤è¿™äº›äº‹ä»¶çš„ç›‘å¬ï¼Œä»¥å…é€ æˆå†…å­˜æ³„æ¼ã€‚</p><h3 id="6-å¾ªç¯æ·»åŠ key"><a href="#6-å¾ªç¯æ·»åŠ key" class="headerlink" title="6. å¾ªç¯æ·»åŠ key"></a>6. å¾ªç¯æ·»åŠ key</h3><p>ç»™æ¯ä¸ªvnodeå¢åŠ ä¸€ä¸ªå”¯ä¸€idï¼Œé«˜æ•ˆçš„æ›´æ–°VNodeã€‚</p><h3 id="7-æ´»ç”¨v-showï¼Œå‡å°‘v-if"><a href="#7-æ´»ç”¨v-showï¼Œå‡å°‘v-if" class="headerlink" title="7. æ´»ç”¨v-showï¼Œå‡å°‘v-if"></a>7. æ´»ç”¨v-showï¼Œå‡å°‘v-if</h3><p>v-ifä¼šæ”¹å˜DOMæ•°ï¼Œv-showé€šè¿‡display:noneçš„æ–¹å¼æ¥æ§åˆ¶æ˜¾ç¤ºå†…å®¹ï¼Œä¸ä¼šæ”¹å˜DOMæ•°</p><h3 id="8-å®¹æ˜“è§¦å‘é‡æ’çš„å…ƒç´ ä¸â€œé™æ€â€å…ƒç´ åˆ†å±‚ï¼ˆä½¿ç”¨z-indexï¼‰"><a href="#8-å®¹æ˜“è§¦å‘é‡æ’çš„å…ƒç´ ä¸â€œé™æ€â€å…ƒç´ åˆ†å±‚ï¼ˆä½¿ç”¨z-indexï¼‰" class="headerlink" title="8. å®¹æ˜“è§¦å‘é‡æ’çš„å…ƒç´ ä¸â€œé™æ€â€å…ƒç´ åˆ†å±‚ï¼ˆä½¿ç”¨z-indexï¼‰"></a>8. å®¹æ˜“è§¦å‘é‡æ’çš„å…ƒç´ ä¸â€œé™æ€â€å…ƒç´ åˆ†å±‚ï¼ˆä½¿ç”¨z-indexï¼‰</h3><p>ä¸€ä¸ªé¡µé¢æ˜¯ç”±è®¸å¤šå±‚çº§ç»„æˆã€‚åœ¨ä¸€ä¸ªé¡µé¢æ„å»ºå®Œæ¸²æŸ“æ ‘åï¼Œæ˜¯ç»å†ä»¥ä¸‹æµç¨‹æ‰æœ€ç»ˆå‘ˆç°åœ¨æˆ‘ä»¬é¢å‰ï¼š</p><p>ï¼ˆ1ï¼‰æµè§ˆå™¨ä¼šå…ˆè·å–DOMæ ‘å¹¶ä¾æ®æ ·å¼å°†å…¶åˆ†å‰²æˆå¤šä¸ªç‹¬ç«‹çš„æ¸²æŸ“å±‚</p><p>ï¼ˆ2ï¼‰CPUå°†æ¯ä¸ªå±‚ç»˜åˆ¶è¿›ç»˜å›¾ä¸­</p><p>ï¼ˆ3ï¼‰å°†ä½å›¾ä½œä¸ºçº¹ç†ä¸Šä¼ è‡³GPUï¼ˆæ˜¾å¡ï¼‰ç»˜åˆ¶</p><p>ï¼ˆ4ï¼‰GPUå°†æ‰€æœ‰çš„æ¸²æŸ“å±‚ç¼“å­˜ï¼ˆå¦‚æœä¸‹æ¬¡ä¸Šä¼ çš„æ¸²æŸ“å±‚æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒGPUå°±ä¸éœ€è¦å¯¹å…¶è¿›è¡Œé‡ç»˜ï¼‰å¹¶ç¬¦åˆå¤šä¸ªæ¸²æŸ“å±‚æœ€ç»ˆå½¢æˆæˆ‘ä»¬çš„å›¾åƒ</p><p>ç”±ä¸Šå¯çŸ¥ï¼šCPUè´Ÿè´£å¸ƒå±€ï¼ŒGPUè´Ÿè´£ç»˜åˆ¶ã€‚</p><p>è¿›è¡Œåˆ†å±‚è®©GPUåˆ†æ‹…æ›´å¤šçš„æ¸²æŸ“å·¥ä½œï¼Œæˆ‘ä»¬é€šå¸¸æŠŠè¿™æ ·çš„æªæ–½ç§°ä¸ºç¡¬ä»¶åŠ é€Ÿ</p><h2 id="äºŒã€æ‰“åŒ…å±‚é¢çš„ä¼˜åŒ–"><a href="#äºŒã€æ‰“åŒ…å±‚é¢çš„ä¼˜åŒ–" class="headerlink" title="äºŒã€æ‰“åŒ…å±‚é¢çš„ä¼˜åŒ–"></a>äºŒã€æ‰“åŒ…å±‚é¢çš„ä¼˜åŒ–</h2><h3 id="1-æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯"><a href="#1-æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯" class="headerlink" title="1.æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯"></a>1.æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯</h3><h3 id="2-ä¸ç”Ÿæˆ-mapæ–‡ä»¶"><a href="#2-ä¸ç”Ÿæˆ-mapæ–‡ä»¶" class="headerlink" title="2.ä¸ç”Ÿæˆ.mapæ–‡ä»¶"></a>2.ä¸ç”Ÿæˆ.mapæ–‡ä»¶</h3><p>vue.config.jsé…ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">productionSourceMap</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-æ‰“åŒ…ç§»é™¤console-log"><a href="#3-æ‰“åŒ…ç§»é™¤console-log" class="headerlink" title="3.æ‰“åŒ…ç§»é™¤console.log"></a>3.æ‰“åŒ…ç§»é™¤console.log</h3><p>åŸå› ï¼šæ¯•ç«Ÿæ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”è¢«console.logè°ƒç”¨çš„å‡½æ•°ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p>ä½¿ç”¨babel-plugin-transform-remove-console</p><h2 id="ä¸‰ã€æœåŠ¡å±‚é¢çš„ä¼˜åŒ–"><a href="#ä¸‰ã€æœåŠ¡å±‚é¢çš„ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€æœåŠ¡å±‚é¢çš„ä¼˜åŒ–"></a>ä¸‰ã€æœåŠ¡å±‚é¢çš„ä¼˜åŒ–</h2><h3 id="1-å‡å°‘HTTPè¯·æ±‚æ•°"><a href="#1-å‡å°‘HTTPè¯·æ±‚æ•°" class="headerlink" title="1.å‡å°‘HTTPè¯·æ±‚æ•°"></a>1.å‡å°‘HTTPè¯·æ±‚æ•°</h3><p>ä¾‹å¦‚ï¼šä½¿ç”¨é›ªç¢§å›¾</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'./images/css_sprites.png'</span><span class="token punctuation">)</span></span> -116px -10px<span class="token punctuation">;</span> //é€šè¿‡è°ƒæ•´positionæ¥å±•ç¤ºå›¾ç‰‡<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é›ªç¢§å›¾è‡ªåŠ¨ç”Ÿæˆç½‘ç«™ï¼š<a href="https://www.toptal.com/developers/css/sprite-generator">https://www.toptal.com/developers/css/sprite-generator</a></p><h3 id="2-å¼€å¯gzipä¼ è¾“å‹ç¼©"><a href="#2-å¼€å¯gzipä¼ è¾“å‹ç¼©" class="headerlink" title="2.å¼€å¯gzipä¼ è¾“å‹ç¼©"></a>2.å¼€å¯gzipä¼ è¾“å‹ç¼©</h3><h3 id="3-DNSé¢„è§£æ"><a href="#3-DNSé¢„è§£æ" class="headerlink" title="3.DNSé¢„è§£æ"></a>3.DNSé¢„è§£æ</h3><p>X-DNS-Prefetch-Controlå¤´æ§åˆ¶ç€æµè§ˆå™¨çš„DNSé¢„è¯»å–åŠŸèƒ½ã€‚DNSé¢„è¯»å–æ˜¯ä¸€é¡¹ä½¿æµè§ˆå™¨ä¸»åŠ¨å»æ‰§è¡ŒåŸŸåè§£æçš„åŠŸèƒ½ï¼Œå…¶èŒƒå›´åŒ…æ‹¬æ–‡æ¡£çš„æ‰€æœ‰é“¾æ¥ï¼Œæ— è®ºæ˜¯å›¾ç‰‡çš„ï¼ŒCSSçš„ï¼Œè¿˜æ˜¯JavaScriptç­‰å…¶ä»–ç”¨æˆ·èƒ½å¤Ÿç‚¹å‡»çš„URL</p><h3 id="4-ä½¿ç”¨CDNåŠ é€Ÿ"><a href="#4-ä½¿ç”¨CDNåŠ é€Ÿ" class="headerlink" title="4.ä½¿ç”¨CDNåŠ é€Ÿ"></a>4.ä½¿ç”¨CDNåŠ é€Ÿ</h3><p>ä½¿ç”¨BootCDNå…è´¹çš„åŠ é€ŸæœåŠ¡ï¼Œç½‘å€ï¼š<a href="https://www.bootcdn.cn/">www.bootcdn.cn/</a></p><p>å®ä¾‹ï¼šå¼•å…¥echarts</p><p>åœ¨index.htmlä¸­ä½¿ç”¨cdnå¼•å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.bootcss.com/echarts/3.7.2/echarts.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨vue.config.jsé…ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">//externalsä¸­çš„keyæ˜¯ç”¨äºimportï¼Œvalueè¡¨ç¤ºåœ¨å…¨å±€ä¸­è®¿é—®åˆ°è¯¥å¯¹è±¡ï¼Œ</span>    <span class="token comment">//å°±æ˜¯window.echartsï¼Œwindowå¯çœç•¥ï¼Œç›´æ¥é€šè¿‡echartè®¿é—®ï¼Œechart.init()</span>    <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token string-property property">'echarts'</span><span class="token operator">:</span> <span class="token string">'echarts'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-ä½¿ç”¨SSRæ¸²æŸ“"><a href="#5-ä½¿ç”¨SSRæ¸²æŸ“" class="headerlink" title="5. ä½¿ç”¨SSRæ¸²æŸ“"></a>5. ä½¿ç”¨SSRæ¸²æŸ“</h3><h2 id="å››ã€å›¾ç‰‡èµ„æºä¼˜åŒ–"><a href="#å››ã€å›¾ç‰‡èµ„æºä¼˜åŒ–" class="headerlink" title="å››ã€å›¾ç‰‡èµ„æºä¼˜åŒ–"></a>å››ã€å›¾ç‰‡èµ„æºä¼˜åŒ–</h2><h3 id="1-å‹ç¼©å›¾ç‰‡"><a href="#1-å‹ç¼©å›¾ç‰‡" class="headerlink" title="1. å‹ç¼©å›¾ç‰‡"></a>1. å‹ç¼©å›¾ç‰‡</h3><p>åœ¨çº¿å‹ç¼©å›¾ç‰‡ç½‘ç«™ï¼š<a href="https://tinypng.com/">tinypng.com</a></p><h3 id="2-ä¸åœ¨HTMLé‡Œç¼©æ”¾å›¾ç‰‡"><a href="#2-ä¸åœ¨HTMLé‡Œç¼©æ”¾å›¾ç‰‡" class="headerlink" title="2. ä¸åœ¨HTMLé‡Œç¼©æ”¾å›¾ç‰‡"></a>2. ä¸åœ¨HTMLé‡Œç¼©æ”¾å›¾ç‰‡</h3><p>å®šä¹‰çš„å›¾ç‰‡å¤šå¤§ï¼Œå°±æ‹¿å¤šå¤§çš„å›¾ç‰‡ï¼Œä¸è¦åœ¨<code>200*200</code>çš„åŒºåŸŸï¼Œæ”¾<code>400*400</code>çš„å›¾ç‰‡</p><h3 id="3-imgæ ‡ç­¾å¢åŠ altå±æ€§"><a href="#3-imgæ ‡ç­¾å¢åŠ altå±æ€§" class="headerlink" title="3. imgæ ‡ç­¾å¢åŠ altå±æ€§"></a>3. imgæ ‡ç­¾å¢åŠ altå±æ€§</h3><p>åœ¨å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼ŒåŒaltå±æ€§æ˜¾ç¤ºæ–‡å­—ï¼ŒåŠ å¿«é¡µé¢çš„ååº”é€Ÿåº¦</p><h3 id="4-å›¾ç‰‡æ‡’åŠ è½½"><a href="#4-å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="4. å›¾ç‰‡æ‡’åŠ è½½"></a>4. å›¾ç‰‡æ‡’åŠ è½½</h3><p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨element-UIçš„å›¾ç‰‡æ‡’åŠ è½½</p><p>æ–¹æ³•äºŒï¼šå½“å…ƒç´ æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸå¤„ï¼Œå†ç»™å›¾ç‰‡çš„srcå±æ€§èµ‹å€¼ï¼Œå»åŠ è½½å›¾ç‰‡</p><h3 id="5-ä½¿ç”¨å­—ä½“å›¾æ ‡ä»£æ›¿å›¾ç‰‡"><a href="#5-ä½¿ç”¨å­—ä½“å›¾æ ‡ä»£æ›¿å›¾ç‰‡" class="headerlink" title="5. ä½¿ç”¨å­—ä½“å›¾æ ‡ä»£æ›¿å›¾ç‰‡"></a>5. ä½¿ç”¨å­—ä½“å›¾æ ‡ä»£æ›¿å›¾ç‰‡</h3>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rustç¯å¢ƒæ­å»º</title>
      <link href="/2022/12/13/rust-huan-jing-da-jian/"/>
      <url>/2022/12/13/rust-huan-jing-da-jian/</url>
      
        <content type="html"><![CDATA[<p>Rust è¯­è¨€æ˜¯ä¸€ç§é«˜æ•ˆã€å¯é çš„é€šç”¨é«˜çº§è¯­è¨€ã€‚å…¶é«˜æ•ˆä¸ä»…é™äºå¼€å‘æ•ˆç‡ï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯ä»¤äººç§°èµçš„ï¼Œæ˜¯ä¸€ç§å°‘æœ‰çš„å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæ‰§è¡Œæ•ˆç‡çš„è¯­è¨€ã€‚</p><h2 id="Rust-ç¯å¢ƒæ­å»º"><a href="#Rust-ç¯å¢ƒæ­å»º" class="headerlink" title="Rust ç¯å¢ƒæ­å»º"></a>Rust ç¯å¢ƒæ­å»º</h2><p>æœ¬æ¬¡æ­å»ºä½¿ç”¨çš„æ˜¯win10çš„wslå®‰è£…çš„openEulerç³»ç»Ÿ</p><h3 id="é¦–å…ˆ"><a href="#é¦–å…ˆ" class="headerlink" title="é¦–å…ˆ"></a>é¦–å…ˆ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">RUSTUP_DIST_SERVER</span><span class="token operator">=</span>https://mirrors.ustc.edu.cn/rust-static<span class="token builtin class-name">export</span> <span class="token assign-left variable">RUSTUP_UPDATE_ROOT</span><span class="token operator">=</span>https://mirrors.ustc.edu.cn/rust-static/rustup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä¸‹è½½å®‰è£…rust"><a href="#ä¸‹è½½å®‰è£…rust" class="headerlink" title="ä¸‹è½½å®‰è£…rust"></a>ä¸‹è½½å®‰è£…rust</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--proto</span> <span class="token string">'=https'</span> <span class="token parameter variable">--tlsv1.2</span> <span class="token parameter variable">-sSf</span> https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> <span class="token string">"<span class="token environment constant">$HOME</span>/.cargo/env"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ£€æµ‹ç¯å¢ƒæ˜¯å¦é…ç½®æˆåŠŸ"><a href="#æ£€æµ‹ç¯å¢ƒæ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="æ£€æµ‹ç¯å¢ƒæ˜¯å¦é…ç½®æˆåŠŸ"></a>æ£€æµ‹ç¯å¢ƒæ˜¯å¦é…ç½®æˆåŠŸ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://kun.nwyp123.com/20221213131919.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rustc <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://kun.nwyp123.com/20221213131948.png"></p><h3 id="å›½å†…é…ç½®rustçš„ä¸‹è½½é•œåƒï¼ˆå¯é€‰ï¼‰"><a href="#å›½å†…é…ç½®rustçš„ä¸‹è½½é•œåƒï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å›½å†…é…ç½®rustçš„ä¸‹è½½é•œåƒï¼ˆå¯é€‰ï¼‰"></a>å›½å†…é…ç½®rustçš„ä¸‹è½½é•œåƒï¼ˆå¯é€‰ï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> .cargo<span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://kun.nwyp123.com/20221213132308.png"></p><p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨configæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºconfigæ–‡ä»¶ï¼Œç„¶åç¼–è¾‘è¾“å…¥ä¸€ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>source.crates-io<span class="token punctuation">]</span>registry <span class="token operator">=</span> <span class="token string">"https://github.com/rust-lang/crates.io-index"</span>replace-with <span class="token operator">=</span> <span class="token string">'ustc'</span><span class="token punctuation">[</span>source.ustc<span class="token punctuation">]</span>registry <span class="token operator">=</span> <span class="token string">"git://mirrors.ustc.edu.cn/crates.io-index"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤rustçš„ç¯å¢ƒå°±é…ç½®å®Œæˆäº†</p>]]></content>
      
      
      <categories>
          
          <category> ç¯å¢ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/12/13/hello-world/"/>
      <url>/2022/12/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¬¢è¿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hello </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
